<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lhrsite.xshop.mapper.ClassifyMapper">

    <sql id="classifyColumns">
        cl_id,
        cl_name,
        cl_grade,
        cl_fid,
        cl_serial,
        eid
    </sql>

    <delete id="delClassify">
        delete
        from classify
        where eid = #{eid}
          and (cl_id = #{id} or cl_fid = #{id})
    </delete>

    <select id="findAllClassify" resultType="com.lhrsite.xshop.po.Classify">
        select
        <include refid="classifyColumns"/>
        from classify
        where eid = #{eid}
        order by cl_grade desc,cl_serial asc
    </select>

    <select id="findClassifyByFid" resultType="com.lhrsite.xshop.po.Classify">
        select
        <include refid="classifyColumns"/>
        from classify
        where cl_fid=#{fid} and
        eid = #{eid}
        order by cl_grade desc
    </select>

    <select id="getClassifyPriceRange" resultType="com.lhrsite.xshop.vo.ClassifyPriceRange">
        select c.cl_id, c.cl_name, max(g.original_price) max, min(original_price) min
        from goods g
                 inner join classify c on g.cl_id = c.cl_id
        where g.status = 0
          and eid = #{eid}
          and c.cl_fid = #{fid}
        group by c.cl_name
    </select>

    <select id="findClassifyByClassName" resultType="com.lhrsite.xshop.po.Classify">
        select
        <include refid="classifyColumns"/>
        from classify where eid = #{eid} and cl_name=#{className}
    </select>

</mapper>